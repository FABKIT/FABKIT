export default function useTinyMCEConfig(cardText) {

    const fabIcons = {
        cost: `
        <span class="fab-icon-container" data-icon="cost">
        <svg class="fab-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 151 151">
        <path fill="#181716" d="M0 75.0419C0.781085 73.9417 0.473102 68.8249 0.704851 67.2039C1.0963 64.4658 1.51224 61.8396 2.10697 59.1164C8.31057 31.0624 30.0024 9.02178 57.9539 2.37153C77.4277 -2.22572 97.929 1.05158 114.999 11.4907C131.829 21.8648 143.893 38.4517 148.579 57.6583C153.323 77.2523 150.047 97.9294 139.48 115.098C129.029 131.991 112.319 144.063 92.9981 148.679C73.4807 153.302 52.9257 149.968 35.87 139.413C19.0261 128.998 6.98139 112.347 2.36043 93.0899C1.49195 89.331 0.897347 85.5141 0.581299 81.6692C0.467863 80.1075 0.651786 77.0898 0 75.9554L0 75.0419Z"/>
        <path fill="#C30821" d="M74.4195 6.92728C112.286 6.32951 143.47 36.5358 144.078 74.4018C144.687 112.268 114.489 143.46 76.6234 144.08C38.7425 144.699 7.53469 114.487 6.926 76.6056C6.3173 38.7245 36.5383 7.52529 74.4195 6.92728Z"/><path fill="#181716" d="M65.8253 17.3173C67.0402 17.0831 70.3754 17.6609 71.6525 17.8325C95.76 21.0706 118.647 33.2446 123.562 58.9656C125.751 70.4229 124.819 81.4667 118.177 91.5094C112.49 100.109 105.058 105.815 94.9311 107.947C89.3932 109.081 83.9703 108.773 78.4588 107.741C80.6062 106.222 82.7753 104.684 84.8528 103.072C99.7975 91.4767 112.386 70.6642 105.477 51.3807C100.138 36.4766 85.7907 26.3738 71.935 20.0503C69.9047 19.1238 67.8432 18.2911 65.8253 17.3173Z"/>
        <path fill="#181716" d="M60.677 29.8495C61.0973 29.7636 63.2313 29.7293 63.7445 29.7172C70.2515 29.5487 76.7032 30.9508 82.5532 33.8047C92.5531 38.6844 97.6477 47.0867 101.132 57.2301C85.2529 49.0047 67.3051 44.3438 49.9514 51.7941C40.1232 56.0135 34.0983 64.1163 30.3734 73.9388C26.4565 83.9644 25.3162 101.267 27.8168 111.723C23.4267 104.321 21.434 93.9028 20.073 85.4636C15.8751 59.4341 33.3141 32.9394 60.677 29.8495Z"/>
        <path fill="#181716" d="M45.5034 63.4295C45.7236 63.5705 45.9636 63.8478 45.9921 64.1104C47.4704 77.7309 51.1978 89.7083 60.2822 100.49C81.0916 125.189 111.476 112.211 131.979 94.3945C129.832 98.2492 124.36 104.863 121.47 108.148C112.185 117.715 101.223 125.997 87.5514 127.689C75.1996 129.217 61.3565 125.777 51.5229 118.019C43.1888 111.319 37.8127 101.62 36.5481 91.0016C35.3353 80.6617 39.1956 71.4138 45.5034 63.4295Z"/>
    </span>
    </svg>`,

        power: `<svg class="fab-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 151 151">
        <path fill="#282627" d="M0 75.0581C0.729021 74.0157 0.584556 68.0537 0.812203 66.3931C1.1577 63.8728 1.5926 61.4755 2.13467 58.9744C8.34778 31.191 29.7541 9.31974 57.3976 2.51111C76.8196 -2.23591 97.3305 0.878393 114.468 11.1765C131.432 21.4379 143.654 37.9861 148.473 57.2173C153.322 76.6896 150.221 97.2912 139.855 114.473C129.573 131.451 113.001 143.679 93.7464 148.495C74.2366 153.304 53.6152 150.157 36.4285 139.747C19.4314 129.43 7.2128 112.801 2.44615 93.4981C1.1027 87.9328 0.427568 82.812 0.426973 77.1148C0.426936 76.7645 0.211384 76.2284 0 75.9439L0 75.0581Z"/>
        <path fill="#F9EB4D" d="M107.872 136.067C78.7872 150.18 46.8526 145.758 24.6126 121.434C-11.9126 81.4845 11.0245 16.2954 64.6997 7.7255C121.628 -1.36375 163.832 60.2502 134.852 109.903C130.351 117.611 125.42 122.832 118.888 128.716C119.293 129.677 119.419 129.577 119.26 130.526C117.572 132.992 112.088 136.004 109.329 137.423L107.872 136.067Z"/>
        <path fill="#282627" d="M46.0099 29.9488C65.9728 43.3121 86.4135 57.8261 106.178 71.5968C106.691 74.446 106.498 79.7909 106.518 82.847L106.751 98.2985C106.809 108.882 106.705 108.154 112.056 117.135C114.356 120.982 116.634 124.842 118.888 128.716C119.293 129.677 119.419 129.577 119.26 130.526C117.572 132.992 112.088 136.004 109.329 137.423L107.872 136.067C106.547 133.795 94.9919 118.476 93.6748 117.435C90.9258 115.263 85.5605 113.437 82.1975 111.927L60.0543 101.929C59.4804 99.8331 58.9021 96.3237 58.468 94.0843L55.6478 79.5182L46.0099 29.9488Z"/>
        <path fill="#F9EB4D" d="M56.5101 43.8523C57.4493 44.2447 63.3117 49.2508 64.5344 50.243L86.5634 68.1868C89.6378 70.6927 95.2525 75.5228 98.3885 77.6372L92.0612 84.5988L86.5425 90.6716L66.698 59.841C63.3773 54.6887 59.6205 49.0894 56.5101 43.8523Z"/>
    </svg>`,

        defense: `<svg class="fab-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 151 151">
        <path fill="#272526" d="M0 75.0644C0.82184 73.9054 0.456293 68.7744 0.70356 67.0995C1.10675 64.3683 1.54089 61.7098 2.13552 58.9962C8.3731 31.0304 30.0026 9.064 57.8687 2.39498C77.3356 -2.22882 97.8409 1.02536 114.92 11.4489C131.815 21.8325 143.921 38.4734 148.599 57.7447C153.318 77.294 150.045 97.9179 139.506 115.046C129.086 131.911 112.432 143.983 93.1627 148.639C73.6436 153.299 53.0725 150.002 35.9875 139.475C19.1593 129.112 7.09705 112.531 2.41889 93.3295C1.69167 90.223 1.15005 87.0761 0.79693 83.9053C0.6049 82.1418 0.5883 76.8221 0 75.9385L0 75.0644Z"/><path fill="#A8A7A8" d="M74.1299 6.92809C112.003 6.17049 143.32 36.259 144.077 74.1325C144.835 112.006 114.746 143.322 76.8727 144.08C38.9994 144.837 7.68323 114.749 6.92582 76.8753C6.16842 39.0021 36.2566 7.6857 74.1299 6.92809Z"/>
        <path fill="#272526" d="M75.9277 28.9613C77.0183 29.1492 82.1367 31.7644 83.5467 32.3618C91.6174 35.7817 99.9804 38.4854 108.59 40.1507C112.674 40.9407 116.461 41.0653 120.471 41.5716C122.645 72.2059 114.617 104.642 87.7123 122.885C86.0352 124.022 77.4604 129.286 75.9317 129.086C67.6509 126.773 59.1907 120.578 53.299 114.467C34.9373 95.4212 29.625 67.1674 30.0193 41.5681C48.6478 39.2672 58.7415 36.5935 75.9277 28.9613Z"/>
        <path fill="#A8A7A8" d="M75.6738 38.2872C76.3512 38.2719 83.999 41.8653 85.3679 42.4029C93.6378 45.6502 101.94 48.2602 110.764 49.4448C110.835 63.6105 109.645 72.5914 104.686 85.8675C101.332 84.4769 97.1106 83.1844 93.4907 81.7467C83.4675 77.6883 73.5285 72.6029 64.8957 66.0532C58.4308 61.1483 52.0812 54.6849 55.3111 45.9211C55.9239 45.6086 56.5708 45.3921 57.2261 45.1865C63.5495 43.2017 69.5739 40.8723 75.6738 38.2872Z"/>
        <path fill="#A8A7A8" d="M41.6392 64.036C42.4992 64.3063 49.3271 68.0379 50.7084 68.8406C63.2246 76.1141 78.3144 83.3101 88.8421 93.2496C90.965 95.2539 93.7534 99.7272 93.4861 102.565C93.2186 105.407 88.4432 109.143 86.2847 111.031C83.2651 113.453 79.0378 116.541 75.4868 118.061C73.2834 116.938 71.1604 115.664 69.1331 114.249C52.3902 102.538 45.0518 83.4061 41.6392 64.036Z"/>
    </svg>`,

        life: `<svg class="fab-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 151 151">
        <path fill="#272526" d="M0 75.065C0.821589 73.9099 0.454932 68.784 0.70309 67.1026C1.10636 64.3702 1.53964 61.7119 2.13485 58.9968C8.38189 30.9851 30.0707 8.99696 57.9941 2.36647C77.4679 -2.22366 97.9665 1.06535 115.027 11.5174C131.882 21.9126 143.952 38.5427 148.61 57.7904C153.325 77.3719 150.022 98.0254 139.436 115.16C128.97 132.031 112.26 144.083 92.9481 148.688C73.403 153.293 52.8291 149.929 35.7685 139.339C18.9808 128.922 6.97749 112.306 2.36302 93.0958C1.66363 90.0653 1.14117 86.9967 0.798303 83.9055C0.606262 82.1411 0.590235 76.8206 0 75.9379L0 75.065Z"/>
        <path fill="#95BC4C" d="M73.9398 6.92649C111.8 6.06525 143.195 36.0497 144.074 73.9098C144.953 111.77 114.983 143.179 77.1231 144.075C39.2386 144.972 7.80486 114.978 6.92556 77.093C6.04625 39.2082 36.0546 7.78828 73.9398 6.92649Z"/>
        <path fill="#272526" d="M73.6505 27.8553C80.8522 26.9568 91.6563 29.7265 98.0684 33.16C108.874 39.0562 116.911 48.9856 120.425 60.7831C125.11 76.391 121.146 87.6685 113.861 101.17C113.906 100.828 113.948 100.485 113.987 100.142C116.149 80.8739 106.224 59.4483 89.4177 49.4454C84.8676 46.7372 80.031 45.4463 74.8095 44.8633C62.0734 42.2874 45.9863 58.8617 57.5417 69.0151C57.434 66.546 57.4008 63.6697 59.0569 61.7128C61.81 58.3172 68.7609 57.6601 71.9695 60.6011C80.1578 68.1066 72.9423 80.645 62.9129 81.1656C56.9105 81.4772 51.4648 79.4491 47.0849 75.8235C42.4732 72.0557 39.5942 66.5726 39.111 60.637C37.1953 39.6009 55.0868 29.4961 73.6505 27.8553Z"/>
        <path fill="#272526" d="M36.4993 50.8943L36.8571 51.1603C36.822 52.3707 36.8009 53.5815 36.7938 54.7924C36.7774 56.4791 36.6374 58.8987 36.7984 60.5361C39.026 82.1654 54.6589 105.423 78.1725 106.237C90.7983 106.675 104.183 92.4707 93.3847 81.7701C93.5205 83.8421 93.6706 86.7685 92.5137 88.4889C88.3318 94.7077 77.4865 92.847 75.7833 85.546C74.1093 78.3701 79.1367 71.8873 85.861 70.2318C91.3914 68.8702 96.5055 70.5134 101.248 73.285C105.737 75.9907 109.121 80.199 110.802 85.1632C112.918 91.4636 112.314 99.581 109.274 105.481C105.313 113.164 97.4927 118.229 89.4989 120.874C77.7385 124.714 64.9415 123.79 53.855 118.3C42.93 112.709 34.6796 103 30.9256 91.3156C27.7001 81.3778 27.9698 70.6358 31.6899 60.8723C32.9272 57.6686 34.9178 54.0164 36.4993 50.8943Z"/>
    </svg>`,

        intellect: `<svg class="fab-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 151 151">
        <path fill="#272526" d="M0 75.0598C0.729609 74.0251 0.596635 68.0256 0.820092 66.3861C1.15724 63.9125 1.57698 61.5525 2.1081 59.0962C8.3029 31.1767 29.8341 9.20885 57.6235 2.4548C77.0721 -2.23217 97.5848 0.952142 114.697 11.3147C131.633 21.6448 143.799 38.2501 148.544 57.5118C153.312 76.9916 150.136 97.5678 139.716 114.703C129.519 131.352 112.677 143.994 93.6354 148.533C73.998 153.335 53.2555 150.084 36.0296 139.503C19.1308 129.103 7.02849 112.445 2.36151 93.1593C1.09554 87.777 0.45611 82.7196 0.434378 77.2183C0.432724 76.7996 0.25161 76.2782 0 75.9371L0 75.0598Z"/>
        <path fill="#9FCFEF" d="M73.9409 6.92456C111.803 6.06338 143.199 36.0494 144.078 73.9112C144.956 111.773 114.985 143.183 77.1232 144.079C39.2373 144.975 7.80262 114.98 6.92356 77.0936C6.0445 39.2072 36.0541 7.7863 73.9409 6.92456Z"/>
        <path fill="#272526" d="M94.7803 73.4707C110.118 72.1455 119.042 60.2339 124.069 46.8215C123.427 55.6663 122.46 61.2247 119.76 69.8203C111.951 92.846 95.9255 110.615 75.3158 123.035C68.5508 119.726 58.5507 111.248 53.3958 105.931C41.1535 93.3059 32.1132 77.4973 28.6226 60.1865C27.9198 56.7014 27.0704 51.4362 27.1423 47.8763C27.7134 48.4877 29.4263 53.196 30.0826 54.4005C35.2705 63.9223 44.1652 72.9518 55.7775 73.2871C60.4213 82.4764 66.4723 92.0375 75.333 97.6289C84.4471 91.3683 89.7602 83.1517 94.7803 73.4707Z"/>
        <path fill="#272526" d="M75.2687 27.9258C76.042 28.455 79.8586 32.4706 80.7987 33.3977C85.6169 38.1493 90.3287 43.1249 95.2411 47.774C91.5045 55.3212 87.7153 62.8423 83.8738 70.3367C81.333 75.2989 77.5526 82.4195 75.4111 87.4765C68.2858 75.5127 62.1451 60.2253 55.1114 47.9811C61.8862 41.4541 68.5197 34.5293 75.2687 27.9258Z"/>
    </svg>`,

        tap: `<svg class="fab-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 151 151">
        <path fill="#282627" d="M72.3264 0L78.4429 0L78.5274 0.0329685C80.478 0.774571 85.1167 1.02101 87.3914 1.39228C90.2734 1.86265 92.7163 2.34863 95.5602 3.14894C116.918 9.16714 134.564 24.2475 143.836 44.4072C146.229 49.6431 147.678 54.3077 148.96 59.882C149.526 62.3425 150.257 70.6697 151 72.1244L151 79.1383L150.968 79.211C150.319 80.7146 149.645 86.7957 149.31 88.9696C148.914 91.48 148.356 93.9623 147.64 96.4008C139.752 122.766 118.9 142.433 92.3426 148.728C90.052 149.271 80.6548 150.298 79.4384 151L71.8345 151C70.7041 150.427 64.0875 149.68 62.318 149.395C59.6596 148.993 57.0296 148.421 54.444 147.684C29.5813 140.391 10.2277 120.807 3.22931 95.8592C2.55681 93.4511 2.01399 91.0086 1.60317 88.5423C1.2797 86.6348 0.756685 79.9967 0 78.7365L0 72.2866C0.634281 71.2432 1.78894 60.7607 2.571 57.8752C3.98903 52.6432 4.48945 50.56 6.7724 45.3644C15.6879 24.7402 33.434 9.24037 55.07 3.18009C59.0867 2.05538 63.0259 1.40418 67.1546 0.921018C68.6233 0.749153 70.915 0.559757 72.2482 0.0317898L72.3264 0Z"/>
        <path fill="#FEFEFE" d="M55.4957 25.6025C56.383 25.444 59.9278 25.3841 60.8868 25.3978C73.3615 25.666 85.2194 30.8763 93.8541 39.8837C104.383 50.7343 107.185 61.8998 106.979 76.445C94.5914 76.7268 80.995 76.5132 68.5288 76.4591C78.018 91.5285 88.403 106.238 97.9743 121.274C100.343 124.995 103.015 129.14 105.61 132.691C102.787 134.215 99.6952 135.48 96.6821 136.568C92.4497 138.151 86.6842 139.318 82.2178 139.78C65.2441 141.606 48.2411 136.607 34.9564 125.885C21.6937 115.21 13.2445 99.6789 11.4862 82.7444C9.96382 67.8537 12.6343 55.2398 22.22 43.4655C30.7422 32.9973 42.0962 26.9617 55.4957 25.6025Z"/>
    </svg>`,

        untap: `<svg class="fab-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 151 151">
        <path fill="#9F6628" d="M72.3227 0L78.4816 0C79.9182 0.802951 88.3864 1.47404 90.7511 1.94731C107.229 5.24514 119.405 13.2135 131.032 24.8701L133.332 27.5275C136.164 30.8113 139.383 35.866 141.502 39.6353C144.112 44.7333 146.176 49.333 147.783 54.8756L148.816 59.142C149.633 62.0173 150.262 70.4764 151 71.5669L151 79.4176C150.521 80.4616 150.426 81.5783 150.298 82.706C149.764 87.4243 149.146 92.0722 147.803 96.6476C141.036 119.235 124.185 137.412 102.174 145.868C98.1145 147.461 94.0749 148.304 89.9064 149.286C87.7982 149.783 80.8096 150.352 79.7197 151L71.5371 151C70.2441 150.164 64.1612 149.937 62.4224 149.619C29.5833 143.619 3.38086 116.193 0.803877 82.6311C0.713254 81.4509 0.49042 79.4798 0 78.4052L0 72.5733C0.204564 72.2716 2.29646 58.574 2.89304 56.2496C9.77028 30.4069 29.8475 10.1564 55.6301 3.0573C57.7617 2.48034 59.9196 2.00505 62.0963 1.63302C63.8167 1.3491 71.2171 0.736735 72.3227 0Z"/>
        <path fill="#FEFEFE" d="M74.547 44.0708C86.1857 43.7001 95.1422 45.2904 104.879 52.0543C140.541 77.1001 127.754 130.216 86.008 139.142C83.0929 139.766 79.8564 139.89 76.8828 139.959C62.4444 140.298 49.6654 136.146 37.8411 128.016C27.1026 120.334 18.9679 109.554 14.5267 97.1196C8.25523 79.3615 10.3418 62.0696 18.3269 45.3683C19.9887 46.7102 23.704 49.0494 25.6074 50.3148L40.579 60.1618C51.2937 67.1977 63.7265 75.8534 74.5349 82.3652C74.3351 69.933 74.3834 56.5128 74.547 44.0708Z"/>
    </svg>`
    };

    const buttons = [
        {
            name: "cost",
            svg: fabIcons.cost,
            icon: "fab-cost",
        },
        {
            name: "power",
            svg: fabIcons.power,
            icon: "fab-power",
        },
        {
            name: "defense",
            svg: fabIcons.defense,
            icon: "fab-defense",
        },
        {
            name: "life",
            svg: fabIcons.life,
            icon: "fab-life",
        },
        {
            name: "intellect",
            svg: fabIcons.intellect,
            icon: "fab-intellect",
        },
        {
            name: "tap",
            svg: fabIcons.tap,
            icon: "fab-tap",
        },
        {
            name: "untap",
            svg: fabIcons.untap,
            icon: "fab-untap",
        },
    ];

    // Create a custom icon pack for TinyMCE
    const createIconPack = () => {
        const iconPack = {};
        buttons.forEach((button) => {
            // TinyMCE expects raw SVG string, not data URL
            iconPack[button.icon] = button.svg;
        });
        return iconPack;
    };

    return {
        selector: 'textarea#cardText',
        license_key: 'gpl',
        pad_empty_with_br: true,
        resize: false,
        height: 285,
        width: '100%',
        paste_as_text: true,
        menubar: false,
        plugins: [
            'importcss', 'lists', 'paste',
        ],
        toolbar: 'bold italic underline alignleft aligncenter alignright alignjustify bullist ' +
            buttons.map((b) => 'fab_' + b.name).join(' '),
        promotion: false,
        branding: false,
        skin: (window.matchMedia("(prefers-color-scheme: dark)").matches ? "oxide-dark" : "oxide"),
        content_css: (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : ""),

        // ADD THESE SVG-SPECIFIC SETTINGS:
        valid_elements: '*[*]',
        extended_valid_elements: 'svg[*],g[*],path[*],circle[*],rect[*],line[*],polyline[*],polygon[*],defs[*],use[*]',
        custom_elements: 'svg,g,path,circle,rect,line,polyline,polygon,defs,use',
        verify_html: false,
        cleanup: false,
        convert_urls: false,

        content_style: `
            @import url('tinymce/fonts.css');
            .fab-icon {
                display: inline-block;
                vertical-align: baseline;
                width: 1em;
                height: 1em;
                margin: 0 0.1em;
            }
        `,
        setup: (editor) => {
            // Register custom icons
            const iconPack = createIconPack();
            Object.keys(iconPack).forEach(iconName => {
                editor.ui.registry.addIcon(iconName, iconPack[iconName]);
            });

            // Register buttons with proper icons
            buttons.forEach((button) => {
                editor.ui.registry.addButton('fab_' + button.name, {
                    icon: button.icon, // Use the icon property instead of text
                    tooltip: `Insert ${button.name} icon`,
                    onAction: () => {
                        editor.insertContent(button.svg, { format: 'raw' });
                        editor.focus();
                    }
                });
            });

            // Your existing change handler
            let editorChangeHandlerId = null;
            editor.on('Paste Change input Undo Redo', function () {
                clearTimeout(editorChangeHandlerId);
                editorChangeHandlerId = setTimeout(function () {
                    cardText.value = editor.getContent();
                }, 250);
            });
        }
    };
}